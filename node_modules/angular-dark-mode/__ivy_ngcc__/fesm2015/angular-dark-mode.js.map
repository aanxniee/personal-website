{"version":3,"file":"angular-dark-mode.js","sources":["../../../projects/angular-dark-mode/src/lib/dark-mode-options.ts","../../../projects/angular-dark-mode/src/lib/default-options.ts","../../../projects/angular-dark-mode/src/lib/isNil.ts","../../../projects/angular-dark-mode/src/lib/media-query.ts","../../../projects/angular-dark-mode/src/lib/media-query.service.ts","../../../projects/angular-dark-mode/src/lib/dark-mode.service.ts","../../../projects/angular-dark-mode/src/public-api.ts","../../../projects/angular-dark-mode/src/angular-dark-mode.ts"],"names":[],"mappings":"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","sourcesContent":["import { InjectionToken } from '@angular/core';\nimport { DarkModeOptions } from './types';\n\n/**\n * InjectionToken to override default options\n *\n * @example\n *\n * providers: [\n *   {\n *     provide: DARK_MODE_OPTIONS,\n *     useValue: {\n *       darkModeClass: 'my-dark-mode',\n *       lightModeClass: 'my-light-mode',\n *     },\n *   },\n * ]\n */\nexport const DARK_MODE_OPTIONS = new InjectionToken<Partial<DarkModeOptions>>(\n  'DARK_MODE_OPTIONS'\n);\n","import { DarkModeOptions } from './types';\n\n/**\n * Default options used in DarkModeService\n */\nexport const defaultOptions: DarkModeOptions = {\n  darkModeClass: 'dark-mode',\n  lightModeClass: 'light-mode',\n  preloadingClass: 'dark-mode-preloading',\n  storageKey: 'dark-mode',\n  element: document.body,\n};\n","/* eslint-disable @typescript-eslint/explicit-module-boundary-types, @typescript-eslint/no-explicit-any */\nexport function isNil(value: any): value is null | undefined {\n  return value === null || value === undefined;\n}\n","export const prefersDarkSchemeQuery = '(prefers-color-scheme: dark)';\n","import { Injectable } from '@angular/core';\nimport { prefersDarkSchemeQuery } from './media-query';\n\n@Injectable({ providedIn: 'root' })\nexport class MediaQueryService {\n  matchMedia(query: string): MediaQueryList {\n    return window.matchMedia(query);\n  }\n\n  prefersDarkMode(): boolean {\n    return this.matchMedia(prefersDarkSchemeQuery).matches;\n  }\n}\n","import {\n  Inject,\n  Injectable,\n  Optional,\n  Renderer2,\n  RendererFactory2,\n} from '@angular/core';\nimport { BehaviorSubject, Observable } from 'rxjs';\nimport { distinctUntilChanged } from 'rxjs/operators';\nimport { DARK_MODE_OPTIONS } from './dark-mode-options';\nimport { defaultOptions } from './default-options';\nimport { isNil } from './isNil';\nimport { MediaQueryService } from './media-query.service';\nimport { DarkModeOptions } from './types';\n\n@Injectable({ providedIn: 'root' })\nexport class DarkModeService {\n  private readonly options: DarkModeOptions;\n  private readonly renderer: Renderer2;\n  private readonly darkModeSubject$: BehaviorSubject<boolean>;\n\n  constructor(\n    private rendererFactory: RendererFactory2,\n    private mediaQueryService: MediaQueryService,\n    // prettier-ignore\n    @Optional() @Inject(DARK_MODE_OPTIONS) private providedOptions: DarkModeOptions | null\n  ) {\n    this.options = { ...defaultOptions, ...(this.providedOptions || {}) };\n    this.renderer = this.rendererFactory.createRenderer(null, null);\n    this.darkModeSubject$ = new BehaviorSubject(this.getInitialDarkModeValue());\n    this.darkModeSubject$.getValue() ? this.enable() : this.disable();\n    this.removePreloadingClass();\n  }\n\n  /**\n   * An Observable representing current dark mode.\n   * Only fires the initial and distinct values.\n   */\n  get darkMode$(): Observable<boolean> {\n    return this.darkModeSubject$.asObservable().pipe(distinctUntilChanged());\n  }\n\n  toggle(): void {\n    this.darkModeSubject$.getValue() ? this.disable() : this.enable();\n  }\n\n  enable(): void {\n    const { element, darkModeClass, lightModeClass } = this.options;\n    this.renderer.removeClass(element, lightModeClass);\n    this.renderer.addClass(element, darkModeClass);\n    this.saveDarkModeToStorage(true);\n    this.darkModeSubject$.next(true);\n  }\n\n  disable(): void {\n    const { element, darkModeClass, lightModeClass } = this.options;\n    this.renderer.removeClass(element, darkModeClass);\n    this.renderer.addClass(element, lightModeClass);\n    this.saveDarkModeToStorage(false);\n    this.darkModeSubject$.next(false);\n  }\n\n  private getInitialDarkModeValue(): boolean {\n    const darkModeFromStorage = this.getDarkModeFromStorage();\n\n    if (isNil(darkModeFromStorage)) {\n      return this.mediaQueryService.prefersDarkMode();\n    }\n\n    return darkModeFromStorage;\n  }\n\n  private saveDarkModeToStorage(darkMode: boolean): void {\n    localStorage.setItem(this.options.storageKey, JSON.stringify({ darkMode }));\n  }\n\n  private getDarkModeFromStorage(): boolean | null {\n    const storageItem = localStorage.getItem(this.options.storageKey);\n\n    if (storageItem) {\n      try {\n        return JSON.parse(storageItem)?.darkMode;\n      } catch (error) {\n        console.error(\n          'Invalid darkMode localStorage item:',\n          storageItem,\n          'falling back to color scheme media query'\n        );\n      }\n    }\n\n    return null;\n  }\n\n  private removePreloadingClass(): void {\n    // defer to next tick\n    setTimeout(() => {\n      this.renderer.removeClass(\n        this.options.element,\n        this.options.preloadingClass\n      );\n    });\n  }\n}\n","/*\n * Public API Surface of angular-dark-mode\n */\n\nexport * from './lib/dark-mode-options';\nexport * from './lib/dark-mode.service';\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n\nexport {MediaQueryService as ɵa} from './lib/media-query.service';\nexport {DarkModeOptions as ɵb} from './lib/types';"]}